{"version":3,"file":"bard-file.js","sourceRoot":"","sources":["../../../src/components/bard-file/bard-file.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Prop, State, Listen, Host, h } from '@stencil/core';\nimport FormController from \"./form-controller\"\nimport { UploadedFile } from \"../uploaded-file/uploaded-file\"\nimport { morph, html, arrayRemove } from \"../../utils/utils\"\nimport '@botandrose/file-drop'\n\n@Component({\n  tag: 'bard-file',\n  styleUrl: 'bard-file.css',\n  shadow: true,\n})\nexport class BardFile {\n  @Element() el: HTMLElement\n\n  @Prop() name: string\n  @Prop() directupload: string\n  @Prop() multiple: boolean = false\n\n  @Prop() required: boolean = false\n  @Prop() accepts: string\n  @Prop() max: number\n  @Prop() preview: boolean = true\n\n  @State() _forceUpdate: boolean = false\n  forceUpdate() { this._forceUpdate = !this._forceUpdate }\n\n  form: HTMLFormElement\n  fileTargetId: string\n  fileTarget: HTMLInputElement\n  hiddenTargetId: string\n  hiddenTarget: HTMLInputElement\n  _files: Array<any> = []\n\n  constructor() {\n    this.fileTargetId = this.el.id\n    this.fileTarget = html(`<input id=\"${this.fileTargetId}\">`) as HTMLInputElement\n    this.hiddenTargetId = `hidden-target-${this.el.getAttribute(\"name\")}`\n    this.hiddenTarget = html(`<input id=\"${this.hiddenTargetId}\">`) as HTMLInputElement\n  }\n\n  componentWillLoad() {\n    this.el.removeAttribute(\"id\")\n    this.form = this.el.closest(\"form\")\n    this.form.addEventListener(\"reset\", () => this.reset())\n    FormController.instance(this.form)\n    const existingFiles = Array.from(this.el.children).filter(e => e.tagName == \"UPLOADED-FILE\");\n    if(existingFiles.length > 0) this.files = existingFiles\n  }\n\n  // Methods\n\n  get files() {\n    return this._files\n  }\n\n  set files(val) {\n    this._files = val\n    if(!this.multiple) this._files = this._files.slice(-1)\n    this.forceUpdate()\n    this.fireChangeEvent()\n  }\n\n  get value() {\n    return this.files.map(e => e.value)\n  }\n\n  set value(val) {\n    const newValue = val || []\n    if(JSON.stringify(this.value) !== JSON.stringify(newValue)) { // this is insane. javascript is fucking garbage.\n      this.files = newValue.map(signedId => Object.assign(new UploadedFile(), {\n        name: this.name,\n        preview: this.preview,\n        signedId,\n      }))\n    }\n  }\n\n  reset() {\n    this.value = []\n  }\n\n  @Listen(\"change\")\n  fileTargetChanged(event) {\n    if(event.target !== this.fileTarget) return\n    this.files.push(...Array.from(this.fileTarget.files).map(file => Object.assign(new UploadedFile(), {\n      name: this.name,\n      preview: this.preview,\n      url: this.directupload,\n      accepts: this.accepts,\n      max: this.max,\n      file,\n    })))\n    this.files = this.files\n    this.fileTarget.value = null\n  }\n\n  @Listen(\"uploaded-file:remove\")\n  removeUploadedFile(event) {\n    arrayRemove(this.files, event.detail)\n    this.files = this.files\n  }\n\n  @Listen(\"direct-upload:end\")\n  fireChangeEvent() {\n    requestAnimationFrame(() => this.el.dispatchEvent(new Event(\"change\", { bubbles: true })))\n  }\n\n  // Rendering\n\n  render() {\n    return (\n      <Host>\n        <file-drop for={this.fileTargetId} onClick={() => this.fileTarget.click()}>\n          <p part=\"title\">\n            <strong>Choose {this.multiple ? \"files\" : \"file\"} </strong>\n            <span>or drag {this.multiple ? \"them\" : \"it\"} here.</span>\n          </p>\n\n          <div class={`media-preview ${this.multiple ? '-stacked' : ''}`}>\n            <slot></slot>\n          </div>\n        </file-drop>\n      </Host>\n    )\n  }\n\n  componentDidRender() {\n    morph(this.fileTarget, `\n      <input id=\"${this.fileTargetId}\"\n        type=\"file\"\n        ${this.multiple ? \"multiple\" : \"\"}\n        ${this.required && this.files.length === 0 ? \"required\" : \"\"}\n        style=\"opacity: 0.01; width: 1px; height: 1px; z-index: -999\"\n      >`)\n    morph(this.hiddenTarget, `\n      <input id=\"${this.hiddenTargetId}\"\n        type=\"hidden\"\n        name=\"${this.name}\"\n        ${this.files.length > 0 ? \"disabled\" : \"\"}\n      >`)\n\n    const wrapper = document.createElement(\"div\")\n    // Clear wrapper and append children (replaceChildren polyfill)\n    while (wrapper.firstChild) {\n      wrapper.removeChild(wrapper.firstChild)\n    }\n    wrapper.appendChild(this.fileTarget)\n    wrapper.appendChild(this.hiddenTarget)\n    this.files.forEach(file => wrapper.appendChild(file))\n    morph(this.el, wrapper, { childrenOnly: true })\n  }\n\n  // Validations\n\n  checkValidity() {\n    return this.fileTarget.checkValidity()\n  }\n\n  setCustomValidity(msg) {\n    this.fileTarget.setCustomValidity(msg)\n  }\n\n  reportValidity() {\n    this.fileTarget.reportValidity()\n  }\n\n  get validationMessage() {\n    return this.fileTarget.validationMessage\n  }\n}\n"]}