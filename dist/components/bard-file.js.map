{"file":"bard-file.js","mappings":"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","names":["BardFile","morph"],"sources":["src/components/bard-file/form-controller.tsx","src/components/bard-file/bard-file.css?tag=bard-file&encapsulation=shadow","src/components/bard-file/bard-file.tsx"],"sourcesContent":["import DirectUploadController from \"../uploaded-file/direct-upload-controller\"\n\nexport default class FormController {\n  static instance(form) {\n    return form.bardFileFormController ||= new FormController(form)\n  }\n\n  progressContainerTarget: HTMLElement\n  dialog: HTMLDialogElement\n\n  element: HTMLFormElement\n  progressTargetMap: {}\n  controllers: Array<DirectUploadController>\n  submitted: boolean\n  processing: boolean\n  errors: boolean\n\n  constructor(form) {\n    this.element = form\n    this.progressTargetMap = {}\n    this.controllers = []\n    this.submitted = false\n    this.processing = false\n    this.errors = false\n\n    this.element.insertAdjacentHTML(\"beforeend\",\n      `<dialog id=\"form-controller-dialog\">\n        <div class=\"direct-upload-wrapper\">\n          <div class=\"direct-upload-content\">\n            <h3>Uploading your media</h3>\n            <div id=\"progress-container\"></div>\n          </div>\n        </div>\n      </dialog>`)\n\n    this.dialog = this.element.querySelector(\"#form-controller-dialog\")\n    this.progressContainerTarget = this.dialog.querySelector(\"#progress-container\")\n\n    if(this.element.dataset.remote !== \"true\") {\n      this.element.addEventListener(\"submit\", event => this.submit(event))\n    }\n    window.addEventListener(\"beforeunload\", event => this.beforeUnload(event))\n\n    this.element.addEventListener(\"direct-upload:initialize\", event => this.init(event))\n    this.element.addEventListener(\"direct-upload:start\", event => this.start(event))\n    this.element.addEventListener(\"direct-upload:progress\", event => this.progress(event))\n    this.element.addEventListener(\"direct-upload:error\", event => this.error(event))\n    this.element.addEventListener(\"direct-upload:end\", event => this.end(event))\n\n    this.element.addEventListener(\"uploaded-file:remove\", event => this.removeUploadedFile(event))\n  }\n\n  beforeUnload(event) {\n    if(this.processing) {\n      event.preventDefault()\n      return (event.returnValue = \"\")\n    }\n  }\n\n  submit(event) {\n    event.preventDefault()\n    this.submitted = true\n    this.startNextController()\n    if(this.processing) {\n      this.dialog.showModal()\n    }\n  }\n\n  startNextController() {\n    if(this.processing) return\n\n    const controller = this.controllers.shift()\n    if(controller) {\n      this.processing = true\n      controller.start(error => {\n        if(error) {\n          Array.from(this.element.querySelectorAll(\"input[type=file]\"))\n            .forEach((e: HTMLInputElement) => e.disabled = false)\n        }\n        this.processing = false\n        this.startNextController()\n      })\n    } else {\n      this.submitForm()\n    }\n  }\n\n  submitForm() {\n    if(this.submitted) {\n      Array.from(this.element.querySelectorAll(\"input[type=file]\"))\n        .forEach((e: HTMLInputElement) => e.disabled = true)\n      window.setTimeout(() => { // allow other async tasks to complete\n        this.element.submit()\n      }, 10)\n    }\n  }\n\n  init(event) {\n    const { id, file, controller } = event.detail\n\n    this.progressContainerTarget.insertAdjacentHTML(\"beforebegin\", `\n      <progress-bar id=\"direct-upload-${id}\" class=\"direct-upload--pending\">${file.name}</progress-bar>\n    `)\n    const progressTarget = document.getElementById(`direct-upload-${id}`)\n    this.progressTargetMap[id] = progressTarget\n\n    this.controllers.push(controller)\n    this.startNextController()\n  }\n\n  start(event) {\n    this.progressTargetMap[event.detail.id].classList.remove(\"direct-upload--pending\")\n  }\n\n  progress(event) {\n    const { id, progress } = event.detail\n    this.progressTargetMap[id].percent = progress\n  }\n\n  error(event) {\n    event.preventDefault()\n    const { id, error } = event.detail\n    const target = this.progressTargetMap[id]\n    target.classList.add(\"direct-upload--error\")\n    target.title = error\n  }\n\n  end(event) {\n    this.progressTargetMap[event.detail.id].classList.add(\"direct-upload--complete\")\n  }\n\n  removeUploadedFile(event) {\n    const uploadedFile = event.detail\n    const id = uploadedFile.controller?.directUpload?.id\n    if(id) {\n      document.getElementById(`direct-upload-${id}`).remove()\n      delete this.progressTargetMap[id]\n    }\n  }\n}\n\n\n",":host {\n  display: block;\n  padding: 25px;\n  color: var(--bard-file-text-color, #000);\n  font-size: 13px;\n}\n:host *{\n  box-sizing: border-box;\n  position: relative;\n}\ndrag-and-drop{\n  display: block;\n  outline-offset: -10px;\n  background: rgba(255,255,255, 0.25);\n  margin: 0;\n  text-align: center;\n  transition: all 0.15s;\n  outline: 2px dashed rgba(0,0,0,0.25);\n  color: #444;\n  font-size: 14px;\n}\n\np{\n  padding: 10px 20px;\n  margin: 0;\n}\n\ndrag-and-drop.-full{\n  width: 100%;\n}\n.-dragover{\n  background: rgba(255,255,255,0.5);\n  outline: 2px dashed rgba(0,0,0,0.25);\n}\n\n.media-preview {\n  display: flex;\n  flex-wrap: wrap;\n  align-items: flex-start;\n  justify-content: center;\n}\n\n// UPLOADER\n\n.direct-upload-wrapper{\n  position: fixed;\n  z-index: 9999;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(#333, 0.9);\n}\n\n.direct-upload-content{\n  display: block;\n  background: #fcfcfc;\n  padding: 40px 60px 60px;\n  border-radius: 3px;\n  width: 60vw;\n}\n.direct-upload-content h3{\n  border-bottom: 2px solid #1f1f1f;\n  margin-bottom: 20px;\n}\n\n.separate-upload{\n  padding: 0 10px;\n  margin-top: 10px;\n  font-size: 0.9em;\n}\n\n.direct-upload--pending{\n  opacity: 0.6;\n}\n\n.direct-upload--complete {\n  opacity: 0.4;\n}\n\n.direct-upload--error{\n  border-color: red;\n}\n\ninput[type=file][data-direct-upload-url][disabled]{\n  display: none;\n}\n\n:host.separate-upload{\n  padding: 0 10px;\n  margin-top: 10px;\n  font-size: 0.9em;\n}\n","import { Component, Element, Prop, State, Listen, Host, h } from '@stencil/core';\nimport FormController from \"./form-controller\"\nimport { UploadedFile } from \"../uploaded-file/uploaded-file\"\nimport { FileDrop as _ } from \"../file-drop/file-drop\"\nimport { morph, html, arrayRemove } from \"../../utils/utils\"\n\n@Component({\n  tag: 'bard-file',\n  styleUrl: 'bard-file.css',\n  shadow: true,\n})\nexport class BardFile {\n  @Element() el: HTMLElement\n\n  @Prop() name: string\n  @Prop() directupload: string\n  @Prop() multiple: boolean = false\n\n  @Prop() required: boolean = false\n  @Prop() accepts: string\n  @Prop() max: number\n  @Prop() preview: boolean = true\n\n  @State() _forceUpdate: boolean = false\n  forceUpdate() { this._forceUpdate = !this._forceUpdate }\n\n  fileTargetId: string\n  fileTarget: HTMLInputElement\n  hiddenTargetId: string\n  hiddenTarget: HTMLInputElement\n  _files: Array<any>\n\n  constructor() {\n    this.fileTargetId = this.el.id\n    this.fileTarget = html(`<input id=\"${this.fileTargetId}\">`) as HTMLInputElement\n    this.hiddenTargetId = `hidden-target-${this.el.getAttribute(\"name\")}`\n    this.hiddenTarget = html(`<input id=\"${this.hiddenTargetId}\">`) as HTMLInputElement\n  }\n\n  componentWillLoad() {\n    this.el.removeAttribute(\"id\")\n    FormController.instance(this.el.closest(\"form\"))\n    this.files = Array.from(this.el.children).filter(e => e.tagName == \"UPLOADED-FILE\")\n  }\n\n  // Methods\n\n  get files() {\n    return this._files\n  }\n\n  set files(val) {\n    this._files = val\n    if(!this.multiple) this._files = this._files.slice(-1)\n    this.forceUpdate()\n    this.fireChangeEvent()\n  }\n\n  get value() {\n    return this.files.map(e => e.value)\n  }\n\n  set value(val) {\n    const newValue = val || []\n    if(JSON.stringify(this.value) !== JSON.stringify(newValue)) { // this is insane. javascript is fucking garbage.\n      this.files = newValue.map(signedId => Object.assign(new UploadedFile(), {\n        name: this.name,\n        preview: this.preview,\n        signedId,\n      }))\n    }\n  }\n\n  @Listen(\"change\")\n  fileTargetChanged(event) {\n    if(event.target !== this.fileTarget) return\n    this.files.push(...Array.from(this.fileTarget.files).map(file => Object.assign(new UploadedFile(), {\n      name: this.name,\n      preview: this.preview,\n      url: this.directupload,\n      accepts: this.accepts,\n      max: this.max,\n      file,\n    })))\n    this.files = this.files\n    this.fileTarget.value = null\n  }\n\n  @Listen(\"uploaded-file:remove\")\n  removeUploadedFile(event) {\n    arrayRemove(this.files, event.detail)\n    this.files = this.files\n  }\n\n  @Listen(\"direct-upload:end\")\n  fireChangeEvent() {\n    requestAnimationFrame(() => this.el.dispatchEvent(new Event(\"change\", { bubbles: true })))\n  }\n\n  // Rendering\n\n  render() {\n    return (\n      <Host>\n        <file-drop for={this.fileTargetId}>\n          <p part=\"title\">\n            <strong>Choose {this.multiple ? \"files\" : \"file\"} </strong>\n            <span>or drag {this.multiple ? \"them\" : \"it\"} here.</span>\n          </p>\n\n          <div class={`media-preview ${this.multiple ? '-stacked' : ''}`}>\n            <slot></slot>\n          </div>\n        </file-drop>\n      </Host>\n    )\n  }\n\n  componentDidRender() {\n    morph(this.fileTarget, `\n      <input id=\"${this.fileTargetId}\"\n        type=\"file\"\n        ${this.multiple ? \"multiple\" : \"\"}\n        ${this.required && this.files.length === 0 ? \"required\" : \"\"}\n        style=\"opacity: 0.01; width: 1px; height: 1px; z-index: -999\"\n      >`)\n    morph(this.hiddenTarget, `\n      <input id=\"${this.hiddenTargetId}\"\n        type=\"hidden\"\n        name=\"${this.name}\"\n        ${this.files.length > 0 ? \"disabled\" : \"\"}\n      >`)\n\n    const wrapper = document.createElement(\"div\")\n    wrapper.replaceChildren(this.fileTarget, this.hiddenTarget, ...this.files)\n    morph(this.el, wrapper, { childrenOnly: true })\n  }\n\n  // Validations\n\n  checkValidity() {\n    return this.fileTarget.checkValidity()\n  }\n\n  setCustomValidity(msg) {\n    this.fileTarget.setCustomValidity(msg)\n  }\n\n  reportValidity() {\n    this.fileTarget.reportValidity()\n  }\n\n  get validationMessage() {\n    return this.fileTarget.validationMessage\n  }\n}\n"],"version":3}