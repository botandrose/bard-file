{"file":"bard-file.js","mappings":";;;;MAEqB,cAAc;IACjC,OAAO,OAAO,CAAC,IAAI;QACjB,OAAO,IAAI,CAAC,sBAAsB,KAAK,IAAI,cAAc,CAAC,IAAI,CAAC,CAAA;KAChE;IAED,uBAAuB;IACvB,MAAM;IAEN,OAAO;IACP,iBAAiB;IACjB,WAAW;IACX,SAAS;IACT,UAAU;IACV,MAAM;IAEN,YAAY,IAAI;QACd,IAAI,CAAC,OAAO,GAAG,IAAI,CAAA;QACnB,IAAI,CAAC,iBAAiB,GAAG,EAAE,CAAA;QAC3B,IAAI,CAAC,WAAW,GAAG,EAAE,CAAA;QACrB,IAAI,CAAC,SAAS,GAAG,KAAK,CAAA;QACtB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAA;QACvB,IAAI,CAAC,MAAM,GAAG,KAAK,CAAA;QAEnB,IAAI,CAAC,OAAO,CAAC,kBAAkB,CAAC,WAAW,EACzC;;;;;;;gBAOU,CAAC,CAAA;QAEb,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,yBAAyB,CAAC,CAAA;QACnE,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAA;QAE/E,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,QAAQ,EAAE,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAA;QACpE,MAAM,CAAC,gBAAgB,CAAC,cAAc,EAAE,KAAK,IAAI,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAA;QAE1E,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,0BAA0B,EAAE,KAAK,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAA;QACpF,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,qBAAqB,EAAE,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAA;QAChF,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,wBAAwB,EAAE,KAAK,IAAI,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAA;QACtF,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,qBAAqB,EAAE,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAA;QAChF,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,mBAAmB,EAAE,KAAK,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAA;KAC7E;IAED,YAAY,CAAC,KAAK;QAChB,IAAG,IAAI,CAAC,UAAU,EAAE;YAClB,KAAK,CAAC,cAAc,EAAE,CAAA;YACtB,QAAQ,KAAK,CAAC,WAAW,GAAG,EAAE,EAAC;SAChC;KACF;IAED,WAAW,CAAC,aAAyB;QACnC,aAAa,CAAC,OAAO,CAAC,YAAY;YAChC,IAAG,YAAY,CAAC,KAAK,KAAK,SAAS,EAAE;gBACnC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,CAAA;gBAC9C,IAAI,CAAC,mBAAmB,EAAE,CAAA;aAC3B;SACF,CAAC,CAAA;KACH;IAED,MAAM,CAAC,KAAK;QACV,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAA;QACrB,IAAI,CAAC,mBAAmB,EAAE,CAAA;QAC1B,IAAG,IAAI,CAAC,UAAU,EAAE;YAClB,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,CAAA;SACxB;KACF;IAED,mBAAmB;QACjB,IAAG,IAAI,CAAC,UAAU;YAAE,OAAM;QAE1B,MAAM,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,CAAA;QAC3C,IAAG,UAAU,EAAE;YACb,IAAI,CAAC,UAAU,GAAG,IAAI,CAAA;YACtB,UAAU,CAAC,KAAK,CAAC,KAAK;gBACpB,IAAG,KAAK,EAAE;oBACR,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC;yBAC1D,OAAO,CAAC,CAAC,CAAmB,KAAK,CAAC,CAAC,QAAQ,GAAG,KAAK,CAAC,CAAA;oBACvD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAA;iBACnB;qBAAM;oBACL,IAAI,CAAC,UAAU,GAAG,KAAK,CAAA;oBACvB,IAAI,CAAC,mBAAmB,EAAE,CAAA;iBAC3B;aACF,CAAC,CAAA;SACH;aAAM;YACL,IAAI,CAAC,UAAU,EAAE,CAAA;SAClB;KACF;IAED,UAAU;QACR,IAAG,IAAI,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YACjC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC;iBAC1D,OAAO,CAAC,CAAC,CAAmB,KAAK,CAAC,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAA;YACtD,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAA;SACtB;KACF;IAED,IAAI,CAAC,KAAK;QACR,MAAM,EAAE,EAAE,EAAE,IAAI,EAAE,GAAG,KAAK,CAAC,MAAM,CAAA;QAEjC,IAAI,CAAC,uBAAuB,CAAC,kBAAkB,CAAC,aAAa,EAAE;wCAC3B,EAAE,oCAAoC,IAAI,CAAC,IAAI;KAClF,CAAC,CAAA;QACF,MAAM,cAAc,GAAG,QAAQ,CAAC,cAAc,CAAC,iBAAiB,EAAE,EAAE,CAAC,CAAA;QACrE,IAAI,CAAC,iBAAiB,CAAC,EAAE,CAAC,GAAG,cAAc,CAAA;KAC5C;IAED,KAAK,CAAC,KAAK;QACT,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,wBAAwB,CAAC,CAAA;KACnF;IAED,QAAQ,CAAC,KAAK;QACZ,MAAM,EAAE,EAAE,EAAE,QAAQ,EAAE,GAAG,KAAK,CAAC,MAAM,CAAA;QACrC,IAAI,CAAC,iBAAiB,CAAC,EAAE,CAAC,CAAC,OAAO,GAAG,QAAQ,CAAA;KAC9C;IAED,KAAK,CAAC,KAAK;QACT,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,MAAM,EAAE,EAAE,EAAE,KAAK,EAAE,GAAG,KAAK,CAAC,MAAM,CAAA;QAClC,MAAM,MAAM,GAAG,IAAI,CAAC,iBAAiB,CAAC,EAAE,CAAC,CAAA;QACzC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAA;QAC5C,MAAM,CAAC,KAAK,GAAG,KAAK,CAAA;KACrB;IAED,GAAG,CAAC,KAAK;QACP,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAA;KACjF;;;ACnIH,MAAM,WAAW,GAAG,s/FAAs/F;;MCU7/FA,UAAQ;;IAanB,UAAU;IACV,UAAU;IACV,YAAY;IACZ,cAAc;IAEd;;;;;;wBAb4B,KAAK;wBAEL,KAAK;;;qBAIJ,EAAE;QAQ7B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,EAAE,CAAC,EAAE,CAAA;QAE5B,MAAM,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE,EAAE,OAAO,EAAE;YACtC,GAAG;gBACD,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,YAAY,IAAI,YAAY,CAAC,KAAK,CAAC,CAAA;aAC1D;YACD,GAAG,CAAE,GAAG;gBACN,IAAI,CAAC,KAAK,GAAG,EAAE,CAAA;gBACf,MAAM,SAAS,GAAG,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAA;gBAC9C,MAAM,QAAQ,GAAG,SAAS,CAAC,GAAG,CAAC,QAAQ;oBACrC,OAAO,YAAY,CAAC,YAAY,CAAC,QAAQ,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,CAAC,CAAA;iBAChE,CAAC,CAAA;gBACF,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,aAAa;oBACtC,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,CAAA;iBAChC,CAAC,CAAA;aACH;SACF,CAAC,CAAA;KACH;IAED,kBAAkB,CAAC,KAAK;QACtB,IAAI,SAAS,GAAG,EAAE,CAAA;QAClB,IAAG,OAAO,KAAK,IAAI,QAAQ,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;YAC/C,SAAS,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;SAC7B;QACD,IAAG,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;YACvB,SAAS,GAAG,KAAK,CAAA;SAClB;QACD,OAAO,SAAS,CAAC,MAAM,CAAC,QAAQ;YAC9B,OAAO,QAAQ,CAAC,QAAQ,EAAE,CAAC,MAAM,GAAG,CAAC,CAAA;SACtC,CAAC,CAAA;KACH;IAED,iBAAiB;QACf,IAAI,CAAC,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,CAAA;QAC7B,IAAI,CAAC,cAAc,GAAG,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAA;KACtE;IAGD,kBAAkB,CAAC,KAAK;QACtB,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,MAAM,CAAC,CAAA;KAC9B;IAED,iBAAiB,CAAC,MAAM;QACtB,MAAM,aAAa,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,IAAI;YAC9D,OAAO,YAAY,CAAC,QAAQ,CAAC,IAAI,EAAE;gBACjC,IAAI,EAAE,IAAI,CAAC,IAAI;gBACf,OAAO,EAAE,IAAI,CAAC,OAAO;gBACrB,GAAG,EAAE,IAAI,CAAC,GAAG;gBACb,GAAG,EAAE,IAAI,CAAC,YAAY;aACvB,CAAC,CAAA;SACH,CAAC,CAAA;QACF,IAAI,CAAC,UAAU,CAAC,KAAK,GAAG,IAAI,CAAA;QAC5B,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,CAAA;QAC/B,IAAG,IAAI,CAAC,aAAa,EAAE,EAAE;YACvB,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,aAAa,CAAC,CAAA;SAC/C;aAAM;YACL,IAAI,CAAC,KAAK,GAAG,EAAE,CAAA;SAChB;KACF;IAED,WAAW,CAAC,aAAa;QACvB,IAAG,IAAI,CAAC,QAAQ,EAAE;YAChB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,CAAA;SAClC;aAAM;YACL,IAAI,CAAC,KAAK,GAAG,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAA;SACrC;QACD,IAAI,CAAC,WAAW,EAAE,CAAA;QAClB,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAA;KAC3C;IAED,UAAU,CAAC,IAAI;QACb,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA;QACtC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAA;QAC3B,IAAI,CAAC,WAAW,EAAE,CAAA;QAClB,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAA;KAC3C;IAED,iBAAiB;QACf,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC,YAAY,EAAE;;;cAG/B,IAAI,CAAC,UAAU;;mCAEM,IAAI,CAAC,IAAI;KACvC,CAAC,CAAA;QACF,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,kBAAkB,CAAC,CAAA;QAC3D,IAAI,CAAC,UAAU,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAA;QACxC,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,QAAQ,EAAE,KAAK,IAAI,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC,CAAA;QAElF,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,oBAAoB,CAAC,CAAA;KAChE;IAED,MAAM;QACJ,IAAI,CAAC,UAAU,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAA;QACnE,IAAI,CAAC,YAAY,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAA;QAElD,QACE,EAAC,IAAI,QACH,iBAAW,GAAG,EAAE,IAAI,CAAC,UAAU,IAC7B,SAAG,KAAK,EAAC,WAAW,GAAK,EACzB,6BAAgB,IAAI,CAAC,QAAQ,GAAG,OAAO,GAAG,MAAM,MAAW,EAC3D,4BAAe,IAAI,CAAC,QAAQ,GAAG,MAAM,GAAG,IAAI,WAAc,EAE1D,WAAK,KAAK,EAAE,iBAAiB,IAAI,CAAC,QAAQ,GAAG,UAAU,GAAG,EAAE,EAAE,IAC5D,eAAa,CACT,CACI,CACP,EACR;KACF;IAED,WAAW;QACT,MAAM,qBAAqB,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,KAAK,eAAe,CAAC,CAAA;QACrG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,YAAY;YAC7B,IAAG,CAAC,qBAAqB,CAAC,QAAQ,CAAC,YAAmB,CAAC,EAAE;gBACvD,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,YAAmB,CAAC,CAAA;aACpC;SACF,CAAC,CAAA;QACF,qBAAqB,CAAC,OAAO,CAAC,GAAG;YAC/B,IAAG,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAU,CAAC,EAAE;gBACnC,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,GAAU,CAAC,CAAA;aAChC;SACF,CAAC,CAAA;KACH;IAED,aAAa;;QAEX,IAAG,KAAK,CAAC,KAAK;YAAE,OAAO,IAAI,CAAA;QAE3B,IAAI,MAAM,GAAG,EAAE,CAAA;QAEf,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,YAAY;YAC7B,IAAG,CAAC,YAAY,CAAC,aAAa,EAAE,EAAE;gBAChC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,CAAA;aAC5C;SACF,CAAC,CAAA;QAEF,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAA;QACxC,IAAI,CAAC,cAAc,EAAE,CAAA;QACrB,OAAO,MAAM,CAAC,MAAM,KAAK,CAAC,CAAA;KAC3B;IAED,iBAAiB,CAAC,GAAG;QACnB,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAA;KACvC;IAED,cAAc;QACZ,IAAI,CAAC,UAAU,CAAC,cAAc,EAAE,CAAA;KACjC;IAED,IAAI,iBAAiB;QACnB,OAAO,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAA;KACzC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":["BardFile"],"sources":["src/components/bard-file/form-controller.tsx","src/components/bard-file/bard-file.css?tag=bard-file&encapsulation=shadow","src/components/bard-file/bard-file.tsx"],"sourcesContent":["import DirectUploadController from \"../uploaded-file/direct-upload-controller\"\n\nexport default class FormController {\n  static forForm(form) {\n    return form.bardFileFormController ||= new FormController(form)\n  }\n\n  progressContainerTarget: HTMLElement\n  dialog: HTMLDialogElement\n\n  element: HTMLFormElement\n  progressTargetMap: {}\n  controllers: Array<DirectUploadController>\n  submitted: boolean\n  processing: boolean\n  errors: boolean\n\n  constructor(form) {\n    this.element = form\n    this.progressTargetMap = {}\n    this.controllers = []\n    this.submitted = false\n    this.processing = false\n    this.errors = false\n\n    this.element.insertAdjacentHTML(\"beforeend\",\n      `<dialog id=\"form-controller-dialog\">\n        <div class=\"direct-upload-wrapper\">\n          <div class=\"direct-upload-content\">\n            <h3>Uploading your media</h3>\n            <div id=\"progress-container\"></div>\n          </div>\n        </div>\n      </dialog>`)\n\n    this.dialog = this.element.querySelector(\"#form-controller-dialog\")\n    this.progressContainerTarget = this.dialog.querySelector(\"#progress-container\")\n\n    this.element.addEventListener(\"submit\", event => this.submit(event))\n    window.addEventListener(\"beforeunload\", event => this.beforeUnload(event))\n\n    this.element.addEventListener(\"direct-upload:initialize\", event => this.init(event))\n    this.element.addEventListener(\"direct-upload:start\", event => this.start(event))\n    this.element.addEventListener(\"direct-upload:progress\", event => this.progress(event))\n    this.element.addEventListener(\"direct-upload:error\", event => this.error(event))\n    this.element.addEventListener(\"direct-upload:end\", event => this.end(event))\n  }\n\n  beforeUnload(event) {\n    if(this.processing) {\n      event.preventDefault()\n      return (event.returnValue = \"\")\n    }\n  }\n\n  uploadFiles(uploadedFiles: Array<any>) {\n    uploadedFiles.forEach(uploadedFile => {\n      if(uploadedFile.state === \"pending\") {\n        this.controllers.push(uploadedFile.controller)\n        this.startNextController()\n      }\n    })\n  }\n\n  submit(event) {\n    event.preventDefault()\n    this.submitted = true\n    this.startNextController()\n    if(this.processing) {\n      this.dialog.showModal()\n    }\n  }\n\n  startNextController() {\n    if(this.processing) return\n\n    const controller = this.controllers.shift()\n    if(controller) {\n      this.processing = true\n      controller.start(error => {\n        if(error) {\n          Array.from(this.element.querySelectorAll(\"input[type=file]\"))\n            .forEach((e: HTMLInputElement) => e.disabled = false)\n          this.errors = true\n        } else {\n          this.processing = false\n          this.startNextController()\n        }\n      })\n    } else {\n      this.submitForm()\n    }\n  }\n\n  submitForm() {\n    if(this.submitted && !this.errors) {\n      Array.from(this.element.querySelectorAll(\"input[type=file]\"))\n        .forEach((e: HTMLInputElement) => e.disabled = true)\n      this.element.submit()\n    }\n  }\n\n  init(event) {\n    const { id, file } = event.detail\n\n    this.progressContainerTarget.insertAdjacentHTML(\"beforebegin\", `\n      <progress-bar id=\"direct-upload-${id}\" class=\"direct-upload--pending\">${file.name}</progress-bar>\n    `)\n    const progressTarget = document.getElementById(`direct-upload-${id}`)\n    this.progressTargetMap[id] = progressTarget\n  }\n\n  start(event) {\n    this.progressTargetMap[event.detail.id].classList.remove(\"direct-upload--pending\")\n  }\n\n  progress(event) {\n    const { id, progress } = event.detail\n    this.progressTargetMap[id].percent = progress\n  }\n\n  error(event) {\n    event.preventDefault()\n    const { id, error } = event.detail\n    const target = this.progressTargetMap[id]\n    target.classList.add(\"direct-upload--error\")\n    target.title = error\n  }\n\n  end(event) {\n    this.progressTargetMap[event.detail.id].classList.add(\"direct-upload--complete\")\n  }\n}\n\n\n",":host {\n  display: block;\n  padding: 25px;\n  color: var(--bard-file-text-color, #000);\n}\n:host *{\n  box-sizing: border-box;\n  position: relative;\n}\ndrag-and-drop{\n  display: block;\n  padding: 40px;\n  outline-offset: -10px;\n  background: rgba(255,255,255, 0.25);\n  margin: 0;\n  text-align: center;\n  transition: all 0.15s;\n  outline: 2px dashed rgba(0,0,0,0.25);\n  color: #444;\n  font-size: 14px;\n}\ndrag-and-drop.-full{\n  width: 100%;\n}\n.-dragover{\n  background: rgba(255,255,255,0.5);\n  outline: 2px dashed rgba(0,0,0,0.25);\n}\n.drag-icon{\n  display: block;\n  text-align: center;\n  font-size: 4em;\n  font-style: normal;\n}\n.drag-icon::before{\n  content: \"\";\n  background: url('data:image/svg+xml;utf8,<svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 159.9 159.7\" style=\"enable-background:new 0 0 159.9 159.7;\" xml:space=\"preserve\"><g><path d=\"M105.7,109.8c0.4-0.7,0.5-1.1,0.7-1.4c4.1-4.1,8.2-8.3,12.4-12.4c0.6-0.6,1.8-1,2.7-1c6.9,0,13.8-0.1,20.7,0.4 c9.5,0.6,17.4,9.1,17.6,18.6c0.2,8.4,0.2,16.8,0.1,25.2c-0.1,12.1-8.8,20.4-21.2,20.4c-26.7,0-53.5,0-80.2,0c-12.2,0-24.3,0-36.5,0 c-13.2,0-21.7-8.2-21.8-21.4c-0.1-8.3-0.2-16.7,0.2-25c0.5-9.6,8.2-17.2,17.7-17.9c6.8-0.5,13.6-0.3,20.5-0.4 c0.8,0,1.9,0.3,2.5,0.8c4.3,4.2,8.5,8.5,12.7,12.7c0.2,0.2,0.3,0.6,0.5,1.2c-1.2,0.1-2.1,0.2-3.1,0.2c-9.7,0-19.5,0-29.2,0 c-5.3,0-7.1,1.8-7.1,7c0,7.1,0,14.2,0,21.2c0,5,1.7,6.7,6.8,6.7c38.9,0,77.8,0,116.7,0c5.1,0,6.8-1.7,6.9-6.9c0-7.1,0-14.2,0-21.2 c0-4.9-1.9-6.8-6.8-6.8c-9.8,0-19.7,0-29.5,0C107.9,109.9,107,109.8,105.7,109.8z\"/><path d=\"M72.5,90.5c0-1,0-1.9,0-2.9c0-25.7,0-51.5,0-77.2c0-1.4,0.1-2.8,0.3-4.2C73.5,2.6,76.6,0,80,0c3.3,0,6.4,2.6,7,6 c0.3,1.4,0.3,2.8,0.3,4.2c0,25.9,0,51.8,0,77.7c0,0.9,0.1,1.8,0.2,3.3c1.3-1,2.1-1.6,2.8-2.3c8.2-8.2,16.4-16.4,24.6-24.5 c1.3-1.3,2.7-2.5,4.2-3.4c2.8-1.6,6.2-1,8.4,1.4c2.1,2.2,2.7,5.7,1.2,8.3c-0.7,1.3-1.7,2.5-2.7,3.6c-13.2,13.2-26.4,26.4-39.6,39.6 c-4.7,4.7-8.5,4.7-13.1,0.1c-13.4-13.4-26.8-26.7-40.1-40.1c-4.2-4.3-4.2-9.4,0-12.3c2.6-1.8,5.3-2,7.9-0.2 c1.4,0.9,2.6,2.1,3.8,3.2c8.2,8.1,16.3,16.2,24.4,24.4c0.7,0.7,1.5,1.4,2.3,2.1C72,90.8,72.2,90.7,72.5,90.5z\"/><path d=\"M120.3,127.2c0.1-4,3.2-7.2,7.1-7.2c4,0,7.3,3.3,7.3,7.3c0,3.8-3.7,7.4-7.3,7.3C123.5,134.6,120.2,131.2,120.3,127.2z\"/></g></svg>');\n  opacity: 0.25;\n  width: 60px;\n  height: 60px;\n  display: inline-block;\n}\n.media-preview {\n  display: flex;\n  flex-wrap: wrap;\n  align-items: flex-start;\n  justify-content: center;\n  margin-top: 10px;\n}\n\n// UPLOADER\n\n.direct-upload-wrapper{\n  position: fixed;\n  z-index: 9999;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(#333, 0.9);\n}\n\n.direct-upload-content{\n  display: block;\n  background: #fcfcfc;\n  padding: 40px 60px 60px;\n  border-radius: 3px;\n  width: 60vw;\n}\n.direct-upload-content h3{\n  border-bottom: 2px solid #1f1f1f;\n  margin-bottom: 20px;\n}\n\n.separate-upload{\n  padding: 0 10px;\n  margin-top: 10px;\n  font-size: 0.9em;\n}\n\n.direct-upload--pending{\n  opacity: 0.6;\n}\n\n.direct-upload--complete {\n  opacity: 0.4;\n}\n\n.direct-upload--error{\n  border-color: red;\n}\n\ninput[type=file][data-direct-upload-url][disabled]{\n  display: none;\n}\n\n:host.separate-upload{\n  padding: 0 10px;\n  margin-top: 10px;\n  font-size: 0.9em;\n}\n","import { Build, Component, Element, Prop, State, Listen, Host, h } from '@stencil/core';\nimport FormController from \"./form-controller\"\nimport { UploadedFile } from \"../uploaded-file/uploaded-file\"\nimport { FileDrop as _ } from \"../file-drop/file-drop\"\n\n@Component({\n  tag: 'bard-file',\n  styleUrl: 'bard-file.css',\n  shadow: true,\n})\nexport class BardFile {\n  @Element() el: HTMLElement\n\n  @Prop() name: string\n  @Prop() directupload: string\n  @Prop() multiple: boolean = false\n\n  @Prop() required: boolean = false\n  @Prop() accepts: string\n  @Prop() max: number\n\n  @State() files: Array<any> = []\n\n  originalId: string\n  fileTarget: HTMLInputElement\n  hiddenTarget: HTMLInputElement\n  formController: FormController\n\n  constructor() {\n    this.originalId = this.el.id\n\n    Object.defineProperty(this.el, \"value\", {\n      get () {\n        return this.files.map(uploadedFile => uploadedFile.value)\n      },\n      set (val) {\n        this.files = []\n        const signedIds = this.signedIdsFromValue(val)\n        const promises = signedIds.map(signedId => {\n          return UploadedFile.fromSignedId(signedId, { name: this.name })\n        })\n        Promise.all(promises).then(uploadedFiles => {\n          this.assignFiles(uploadedFiles)\n        })\n      },\n    })\n  }\n\n  signedIdsFromValue(value) {\n    let signedIds = []\n    if(typeof value == \"string\" && value.length > 0) {\n      signedIds = value.split(\",\")\n    }\n    if(Array.isArray(value)) {\n      signedIds = value\n    }\n    return signedIds.filter(signedId => {\n      return signedId.toString().length > 0\n    })\n  }\n\n  connectedCallback() {\n    this.el.removeAttribute(\"id\")\n    this.formController = FormController.forForm(this.el.closest(\"form\"))\n  }\n\n  @Listen(\"uploaded-file:remove\")\n  removeUploadedFile(event) {\n    this.removeFile(event.detail)\n  }\n\n  fileTargetChanged(_event) {\n    const uploadedFiles = Array.from(this.fileTarget.files).map(file => {\n      return UploadedFile.fromFile(file, {\n        name: this.name,\n        accepts: this.accepts,\n        max: this.max,\n        url: this.directupload,\n      })\n    })\n    this.fileTarget.value = null\n    this.assignFiles(uploadedFiles)\n    if(this.checkValidity()) {\n      this.formController.uploadFiles(uploadedFiles)\n    } else {\n      this.files = []\n    }\n  }\n\n  assignFiles(uploadedFiles) {\n    if(this.multiple) {\n      this.files.push(...uploadedFiles)\n    } else {\n      this.files = uploadedFiles.slice(-1)\n    }\n    this.renderFiles()\n    this.el.dispatchEvent(new Event(\"change\"))\n  }\n\n  removeFile(file) {\n    const index = this.files.indexOf(file)\n    this.files.splice(index, 1)\n    this.renderFiles()\n    this.el.dispatchEvent(new Event(\"change\"))\n  }\n\n  componentWillLoad() {\n    this.el.insertAdjacentHTML(\"afterbegin\", `\n      <input type=\"file\"\n        style=\"opacity: 0.01; position: absolute; z-index: -999\"\n        id=\"${this.originalId}\"\n      />\n      <input type=\"hidden\" name=\"${this.name}\" />\n    `)\n    this.fileTarget = this.el.querySelector(\"input[type=file]\")\n    this.fileTarget.multiple = this.multiple\n    this.fileTarget.addEventListener(\"change\", event => this.fileTargetChanged(event))\n\n    this.hiddenTarget = this.el.querySelector(\"input[type=hidden]\")\n  }\n\n  render() {\n    this.fileTarget.required = this.files.length === 0 && this.required\n    this.hiddenTarget.disabled = this.files.length > 0\n\n    return (\n      <Host>\n        <file-drop for={this.originalId}>\n          <i class=\"drag-icon\"></i>\n          <strong>Choose {this.multiple ? \"files\" : \"file\"} </strong>\n          <span>or drag {this.multiple ? \"them\" : \"it\"} here.</span>\n\n          <div class={`media-preview ${this.multiple ? '-stacked' : ''}`}>\n            <slot></slot>\n          </div>\n        </file-drop>\n      </Host>\n    )\n  }\n\n  renderFiles() {\n    const existingUploadedFiles = Array.from(this.el.children).filter(e => e.tagName === \"UPLOADED-FILE\")\n    this.files.forEach(uploadedFile => {\n      if(!existingUploadedFiles.includes(uploadedFile as any)) {\n        this.el.append(uploadedFile as any)\n      }\n    })\n    existingUploadedFiles.forEach(dom => {\n      if(!this.files.includes(dom as any)) {\n        this.el.removeChild(dom as any)\n      }\n    })\n  }\n\n  checkValidity() {\n    // FIXME work around UploadedFile constructor not running in dev\n    if(Build.isDev) return true\n\n    let errors = []\n\n    this.files.forEach(uploadedFile => {\n      if(!uploadedFile.checkValidity()) {\n        errors.push(uploadedFile.validationMessage)\n      }\n    })\n\n    this.setCustomValidity(errors.join(\" \"))\n    this.reportValidity()\n    return errors.length === 0\n  }\n\n  setCustomValidity(msg) {\n    this.fileTarget.setCustomValidity(msg)\n  }\n\n  reportValidity() {\n    this.fileTarget.reportValidity()\n  }\n\n  get validationMessage() {\n    return this.fileTarget.validationMessage\n  }\n}\n\n"],"version":3}